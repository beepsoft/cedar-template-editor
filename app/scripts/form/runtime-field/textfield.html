
<!--- not active --->
<div ng-if="!isActive(index)" class="form-group  has-feedback value">

  <div ng-if="isRegular()"
      ng-click="setActive(index,true)"
      aria-label="{{getDescription()}}"
      class="isInactive">{{valueElement['@value']}}</div>

  <div ng-if="!isRegular()"
      ng-click="setActive(index,true)"
      aria-label="{{getDescription()}}"
      class="isInactive">{{valueElement['_valueLabel']}}</div>

</div>

<!-- actively being edited -->
<div ng-if="isActive(index)">

  <!--Regular field-->
  <div ng-if="isRegular()"
      class="form-group  has-feedback ">

    <input type="text"
        class="form-control select"
        ng-class="{'isActive' : isActive(index), 'required': isRequired()}"
        placeholder="{{isActive(index) ? 'enter answer' : ''}}"
        aria-label="{{getDescription()}}"
        ng-model="valueElement['@value']">
    </input>
    <div class="input-indicator-icons" ng-include="'scripts/form/partials/indicator-icons.partial.html'"></div>
  </div>


  <!--Field whose values have been constrained using controlled terms -->
  <div ng-if="isConstrained()" class="form-group  has-feedback">

    <div ng-init="initializeControlledField()"
        class="has-constraint " ng-class="{'has-selected': (valueElement['@value'].label || valueElement['_valueLabel'])}"
        style="border:1px solid #ddd;box-shadow:none;">

      <ui-select
          ng-change="updateModelFromUIControlledField()"
          ng-model="modelValue[index]['@value']"
          theme="bootstrap"
          close-on-select="true"
          aria-label="getDescription()">
        <ui-select-match placeholder="">{{$select.selected.label}}</ui-select-match>
        <ui-select-choices
            ui-disable-choice="option.label == 'No Results...'"
            refresh="$root.updateFieldAutocomplete($root.schemaOf(field), $select.search)"
            refresh-delay="200"
            repeat="option in $root.autocompleteResultsCache[$root.schemaOf(field)['@id']]['results'] | propsFilter: {label: $select.search} | limitTo:500">
          <div ng-bind-html="option.label | highlight: $select.search"></div>
        </ui-select-choices>
      </ui-select>
    </div>
  </div>


  <!-- Field with value recommendation functionality -->
  <div ng-if="isRecommended()" class="form-group  has-feedback">


    <div ng-init="initializeValueRecommendationField()"
        class="has-constraint autocomplete-label-wrapper"
        ng-class="{'has-selected': modelValueRecommendation['@value'].value}">
      <ui-select
          ng-model="modelValueRecommendation['@value']"
          ng-change="updateModelWhenChangeSelection(modelValueRecommendation); $root.vrs.updatePopulatedFields(field, modelValueRecommendation['@value'].value)"
          ng-click="$root.vrs.updateValueRecommendationResults(field); setIsFirstRefresh(false); clearSearch($select)"
          close-on-select="true"
          reset-search-input="false"
          aria-label="getDescription()">
        <ui-select-match class="selection-field" placeholder="">{{$select.selected.value}}
          <i ng-if="$select.selected.value" class="fa fa-times" aria-hidden="true"
              ng-click="clearSelection($event, $select); $root.vrs.updatePopulatedFields(field, null)"></i>
        </ui-select-match>
        <ui-select-choices
            ui-disable-choice="option.value == $root.vrs.getNoResultsMsg()"
            refresh="updateModelWhenRefresh($select, modelValueRecommendation); $root.vrs.updatePopulatedFields(field, $select.search); $root.updateFieldAutocomplete(field, $select.search)"
            refresh-delay="200"
            repeat="option in $root.vrs.getValueRecommendationResults(field['@id']) | propsFilter: {value: $select.search} | limitTo:100">
          <div>
            <span ng-if="option.valueUri != undefined"
                class='controlledTerm fa fa-share-alt-square fa-rotate-90'></span>&nbsp;
            <span ng-bind-html="option.value | highlight: $select.search"></span>&nbsp;
            <span ng-if="option.valueUri != undefined">({{$root.cts.getAcronymFromTermUri(option.valueUri)}})</span>&nbsp;
            <small ng-if="option.score != undefined">(<span>{{calculateUIScore(option.score)}}</span>)</small>
            &nbsp;
            <!--<small ng-if="option.type!=undefined"><span>{{getRecommendationType(option.type)}}</span></small>-->
          </div>
        </ui-select-choices>
      </ui-select>
    </div>
  </div>

</div>







