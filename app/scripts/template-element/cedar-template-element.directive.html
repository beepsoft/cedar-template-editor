<div ng-if="model !== undefined" class="element-root" id="{{$root.getDomId(element)}}"
     ng-click="canSelect(!isRootElement && !$root.isRuntime() && !isNested(), $event); $event.preventDefault(); "
     ng-class="{'selected': isEditState(element)}">


    <!-- sort hander -->
    <div class="row" ng-show="!isRootElement">
        <div class="sortable-handler" style="height:30px;" ng-class="{'invisible': $root.isRuntime() }"
             ng-mousedown="canSelect(!$root.isRuntime(), $event); $event.preventDefault(); ">
            <div class="type-label sortable"><span class="sortable-icon"></span></div>
        </div>
    </div>

    <!-- element title and runtime toolbar -->
    <div class="row" ng-show="!isRootElement">

        <div class="col-sm-9">
            <field-title-directive field-or-element="element"></field-title-directive>
        </div>

        <div class="col-sm-3">
            <runtime-toolbar-directive field-or-element="element" ng-model="model" add="addMoreInput"
                                       spreadsheet="switchToSpreadsheet();"></runtime-toolbar-directive>
        </div>
    </div>


    <!-- elements -->
    <div class="elementTotalContent visible">
        <div ng-show="$root.isArray(model)">
            <div class="spreadsheetViewDetector"></div>
            <div class="spreadsheetViewContainer"></div>
        </div>

        <div class="elements originalContent">
            <div class="element-toggles list" ng-if="$root.isRuntime() && $root.elementIsMultiInstance(element)">

                <div class="element-toggle"
                     ng-class="{active: selectedTab == $index}"
                     ng-repeat="m in model"
                     ng-click="selectTab($index)"
                     ng-if="$root.isArray(model) && model.length > 0">
                    <span>{{$index + 1}}</span>
                </div>
                <div class="add-element">
                    <button type="button"
                            tooltip="add a {{$root.schemaOf(element)._ui.title}}"
                            tooltip-trigger
                            tooltip-animation="false"
                            tooltip-placement="top"
                            data-toggle="tooltip"
                            ng-click="addElement(); $event.stopPropagation();"
                            class="add zero noOutline"
                            ng-show="true"
                            ng-disabled="preview"
                            style="outline:none">
                        <i class="fa fa-plus"></i>
                    </button>
                </div>
                <div class="clearfix"></div>
            </div>
            <!-- /.date-type-toggle -->

            <!-- have an array with at least one element -->
            <div ng-if="$root.isArray(model) && selectedTab == $index" class="element" ng-repeat="m in model"
                 ng-class="['element-{{$index}}']">
                <div class="remove-element pull-right">
                    <a class="" ng-show="model.length > element.minItems" ng-click="removeElement($index)" translate>GENERIC.Remove</a>
                </div>

                <div ui-sortable="$root.sortableOptions" ng-model="$root.schemaOf(element)._ui.order"
                     class="sortable-container">
                    <div ng-repeat="key in $root.schemaOf(element)['_ui']['order']">
                        <div ng-if="$root.propertiesOf(element)[key]">
                            <cedar-nested-template-element key="key"
                                                           field="$root.propertiesOf(element)[key]"
                                                           model="m[key]"
                                                           remove-child="removeChild"
                                                           rename-child-key="renameChildKey">
                            </cedar-nested-template-element>
                        </div>
                    </div>
                </div>
            </div>

            <!-- have an array with no elements -->
            <div ng-if="!$root.isRuntime() && $root.isArray(model) && model.length == 0" class="element"
                 ng-class="['element-0']">
                <div ui-sortable="$root.sortableOptions" ng-model="element._ui.order" class="sortable-container">
                    <div ng-repeat="key in $root.schemaOf(element)['_ui']['order']">

                        <div ng-if="true">
                            <cedar-nested-template-element key="key"
                                                           field="$root.propertiesOf(element)[key]"
                                                           model="m[key]"
                                                           preview="preview" ,
                                                           remove-child="removeChild"
                                                           rename-child-key="renameChildKey"
                                    >
                            </cedar-nested-template-element>
                        </div>
                    </div>
                </div>
            </div>

            <!-- not an array -->
            <div ng-if="!$root.isArray(model)" class="element only-element" ui-sortable="$root.sortableOptions"
                 ng-model="element._ui.order">
                <div ng-repeat="key in $root.schemaOf(element)['_ui']['order']">
                    <div ng-if="$root.propertiesOf(element)[key]">
                        <cedar-nested-template-element key="key"
                                                       field="$root.propertiesOf(element)[key]"
                                                       model="model[key]"
                                                       remove-child="removeChild"
                                                       rename-child-key="renameChildKey">
                        </cedar-nested-template-element>
                    </div>
                </div>
            </div>
        </div>


    </div>


    <!-- edittime toolbar -->
    <div class="row">
        <div class="col-sm-12">
            <edittime-toolbar-directive field-or-element="element" uuid="uuid" duplicate="duplicate();" is-edit="isEditState(element);"
                                        delete="delete();"></edittime-toolbar-directive>
        </div>
    </div>


</div>

