<span ng-show="tsc.isFieldTypesMode()">Find a term in BioPortal to annotate the <span class="highlighted">'{{tsc.fieldName}}'</span> field or <button
    type="button" class="btn btn-create-term" ng-click="tsc.switchToCreate()">Create a New Term
</button>
</span>
<h4 ng-show="tsc.isFieldValuesMode()">Find terms in BioPortal to constrain the values of the <span class="highlighted">'{{tsc.fieldName}}'</span>
  field</h4>

<div ng-if="tsc.isSearching()" class="form-group floating-label-wrapper clearfix">

  <div class="form-group form-group-actions clearfix">
    <!-- Start over -->
    <div class="btn-start-over-group clearfix">
      <!--<button type="button" class="btn btn-start-over" ng-click="tsc.reset(false, false)"><span class="fa fa-refresh primary-color"></span> Start Over</button>-->
      <button type="button" class="btn btn-start-over" ng-click="tsc.reset(false, false)"><span class="primary-color"></span> Start Over</button></div>
    <!-- Search Field -->
    <div class="field-search">
      <div class="input-group field-search-input-group">
        <input id="field-search-input" type="text" class="form-control field-search-form-control"
            placeholder="Search for terms in BioPortal" aria-label="Search field"
            ng-model="tsc.searchQuery" ng-focus="tsc.showEmptyQueryMsg = false"
            with-floating-label=""
            ng-model-options="{debounce: 700}"
            ng-submit="tsc.search($event)"
            ng-click="tsc.onTextClick($event)"/>
        <span class="input-group-addon" ng-click="tsc.search()"><i class="fa fa-search"></i></span>
        <span class="input-group-addon" ng-click="tsc.changeSearchOptionsVisibility()">
          <i ng-class="{'fa fa-cog': !tsc.searchOptionsVisible, 'fa fa-cog selected': tsc.searchOptionsVisible}"></i>
        </span>
      </div>
    </div>

    <div ng-show="tsc.searchOptionsVisible" class="advanced-search">
      <p class="advanced-search-header">Advanced Search</p>
      <span>Narrow your search to specific ontologies:</span>

      <div class="field-ontologies">
        <tags-input class="custom-tags-input" ng-model="tsc.selectedOntologies" display-property="id"
            placeholder="Add ontologies" replace-spaces-with-dashes="false">
          <auto-complete source="tsc.loadOntologies($query)"
              display-property="fullName"
              min-length="0"
              load-on-focus="true"
              load-on-empty="true"
              max-results-to-show="5000"
              minLength="2"
          </auto-complete>
        </tags-input>
      </div>
    </div>
    <!--<div class="field-ontologies">-->
    <!--<div class="more-items">-->
    <!--<button type="button" class="btn btn-field-browse btn-block" data-toggle="dropdown" aria-expanded="false"-->
    <!--ng-click="cctopdc.fieldBrowse($event)">-->
    <!--<span class="pull-left text">Select ontologies or leave it blank to select all</span> <i-->
    <!--class="fa fa-angle-down fa-2x pull-right"></i>-->
    <!--<span class="clearfix"></span>-->
    <!--</button>-->
    <!--</div>-->
    <!--</div>-->
  </div>
  <!-- Advanced options -->
  <!--<button type="button" class="btn btn-advanced" ng-click="tsc.reset()">Advanced</button>-->
  <!--<div class="text-center search-options">-->
  <!--<div class="radio inline-block radio-primary radio-controlled-terms-search"-->
  <!--ng-show="!tsc.isMappingsMode()">-->
  <!--<input id="search-scope-1" type="radio" ng-model="tsc.searchScope" value="classes"-->
  <!--ng-click="$event.stopPropagation()" ng-change="tsc.changeSearchScope()"/>-->
  <!--<label>Ontology Terms</label>-->
  <!--</div>-->
  <!--<div class="radio inline-block radio-primary radio-controlled-terms-search"-->
  <!--ng-show="!tsc.isMappingsMode()">-->
  <!--<input id="search-scope-2" type="radio" ng-model="tsc.searchScope" value="ontologies"-->
  <!--ng-click="$event.stopPropagation()" ng-change="tsc.changeSearchScope()"/>-->
  <!--<label>Ontologies</label>-->
  <!--</div>-->
  <!--<div class="radio inline-block radio-primary radio-controlled-terms-search"-->
  <!--ng-show="tsc.isFieldValuesMode()">-->
  <!--<input id="search-scope-3" type="radio" ng-model="tsc.searchScope" value="value-sets"-->
  <!--ng-click="$event.stopPropagation()" ng-change="tsc.changeSearchScope()"/>-->
  <!--<label>Value sets</label>-->
  <!--</div>-->
  <!--</div>-->
  <!-- Search messages -->
  <div class="preloader" ng-if="tsc.showSearchPreloader"></div>
  <div class="searchMsg" ng-if="tsc.showEmptyQueryMsg">Please enter a search query</div>

  <div class="searchMsg" ng-if="tsc.searchFinished">
    <div ng-if="tsc.resultsFound && !tsc.isMappingsMode()">
      <div>{{tsc.searchClassesResults.length}} results</div>
      <div>Click on a term to see more details about it</div>
    </div>
    <div ng-if="!tsc.resultsFound">No results</div>
  </div>
</div>


<!-- Search Results and Ontology Tree -->
<div class="clear search-results-section">
  <!-- Classes results -->
  <div ng-if="tsc.isSearchingClasses() && tsc.resultsFound && tsc.searchFinished">
    <div class="search-results-headers">
      <table class="table table-condensed results-headers-table search-results-headers-table">
        <thead>
        <tr>
          <th width="16%">Term</th>
          <th width="36%">Definition</th>
          <th width="15%">Ontology</th>
          <th width="14%">Id</th>
          <th width="14%"></th>
        </tr>
        </thead>
      </table>
    </div>
    <div class="search-results">
      <div class="no-search-results" ng-show="!tsc.resultsFound">No results.</div>
      <div class="table-responsive results-table-container">
        <table class="table table-hover results-table search-results-table" ng-if="tsc.isSearchingClasses()">
          <tbody>
          <!-- Note that the comparison (result.resultId == tsc.selectedResultId) ensures that multiple classes with the same id are not highlighted at the same time and (result.details.id == tsc.selectedClass.id) deselects the row if the user clicks on another class in the ontology tree -->
          <tr ng-repeat="result in tsc.searchClassesResults" ng-click="tsc.selectFieldClass(result, result.resultId)"
              ng-class="{'selected-row':  (result.resultId == tsc.selectedResultId) && (result.details.id == tsc.selectedClass.id)}">
            <td width="16%">{{result.prefLabel}}</td>
            <td width="36%">(definition here)</td>
            <td width="15%" tooltip="{{result.ontology.name}}" tooltip-append-to-body="true">{{result.ontology.id}}</td>
            <td width="14%" tooltip="{{tsc.getShortId(result.details.id, null)}}" tooltip-append-to-body="true">
              {{tsc.getShortId(result.details.id, 16)}}
            </td>
            <td width="13%">
              <span class="fa fa-sitemap"
                  ng-if="(result.resultId == tsc.selectedResultId) && (result.details.id == tsc.selectedClass.id)"
                  ng-click="tsc.changeTreeVisibility(); $event.stopPropagation()"></span>
              <span class="show-details"
                  ng-if="(result.resultId == tsc.selectedResultId) && (result.details.id == tsc.selectedClass.id) && !tsc.treeVisible"
                  ng-click="tsc.changeTreeVisibility(); $event.stopPropagation()">Show Details</span>
              <span class="show-details"
                  ng-if="(result.resultId == tsc.selectedResultId) && (result.details.id == tsc.selectedClass.id) && tsc.treeVisible"
                  ng-click="tsc.changeTreeVisibility(); $event.stopPropagation()">Hide Details</span>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <!-- Ontologies results -->
  <div ng-if="tsc.isSearchingOntologies()">
    <div class="search-results-headers">
      <table class="table table-condensed results-headers-table browse-results-headers-table">
        <thead>
        <tr>
          <th width="45%">Ontology</th>
          <th width="45%">Categories</th>
          <th width="10%">No. Terms</th>
        </tr>
        </thead>
      </table>
    </div>
    <div class="search-results">
      <div class="table-responsive results-table-container">
        <table class="table table-hover results-table browse-results-table">
          <tbody>
          <tr ng-repeat="result in tsc.searchOntologiesResults" ng-click="tsc.selectFieldOntology(result)"
              ng-show="tsc.isOntologyNameMatched(result)"
              ng-class="{'selected-row':  (result.id == tsc.currentOntology.info.id)}">
            <td width="45%">{{result.name}} ({{result.id}})</td>
            <td width="45%">{{result.details.categories.join(", ") || "-" }}</td>
            <td width="9%">{{result.details.numberOfClasses | number}}</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div ng-if="tsc.treeVisible && tsc.isLoadingClassDetails"><br/>Loading details...</div>
  <!-- Ontology tree -->
  <div class="field-tree clear" ng-show="tsc.treeVisible && !tsc.isLoadingClassDetails">
    <div class="field-tree-header table-style">
      <!-- Tree header -->
      <div class="ontology-tree-header table-cell-style" ng-if="tsc.isCurrentOntology()">
        <h4>
          <!--<a class="pull-left" ng-click="tsc.hideTree()">-->
          <!--<img src="../img/left-arrow.png" />-->
          <!--</a>-->
          <!--&nbsp;&nbsp;&nbsp;&nbsp;-->
          {{tsc.currentOntology.info.id}} term tree
        </h4>
      </div>
      <!-- Term and ontology details header -->
      <div class="field-details-view table-cell-style" ng-if="tsc.isCurrentOntology()">
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="detail-view-tab active">
            <a href="#class-details" aria-controls="class-details" role="tab" data-toggle="tab">Term Details</a>
          </li>
          <li role="presentation" class="detail-view-tab">
            <a href="#ontology-details" aria-controls="ontology-details" role="tab" data-toggle="tab">Ontology
              Details</a>
          </li>
        </ul>
      </div>
      <div class="clearfix"></div>
    </div>
    <div class="field-tree-details">
      <div class="ontology-tree pull-left" ng-if="tsc.isCurrentOntology()">
        <div class="tree tree-view-ul tree-view list-unstyled class-tree-container"
            ng-if="!tsc.currentOntology.info.flat">
          <cedar-class-tree
              tree="tsc.currentOntology.tree"
              selected-node="tsc.selectedClass"
              is-selected-callback="tsc.checkIfSelected"
              get-class-details-callback="tsc.getClassDetails">
          </cedar-class-tree>
        </div>
        <div class="tree tree-view-message" ng-if="tsc.currentOntology.info.flat">Tree browsing not supported for this
          ontology
        </div>
      </div>
      <!-- /.ontology-tree -->

      <div class="field-details-view pull-right" ng-if="tsc.isCurrentOntology()">
        <div class="tab-content">
          <div id="class-details" class="tab-pane active" role="tabpanel">
            <div class="no-selected-class text-center" ng-hide="tsc.classDetails">Click on any term in the ontology
              tree
            </div>
            <div class="table-responsive">
              <table class="table table-striped">
                <tbody ng-show="tsc.classDetails">
                <tr>
                  <th>Name</th>
                  <td>{{tsc.classDetails.prefLabel}}</td>
                </tr>
                <tr>
                  <th>Id</th>
                  <td>{{tsc.classDetails['@id']}}</td>
                </tr>
                <tr>
                  <th>Definition</th>
                  <!--<td ng-if="tsc.classDetails.definition[0]">{{tsc.classDetails.definition[0]}}</td>-->
                  <td ng-if="tsc.classDetails.definitions[0]">{{tsc.classDetails.definitions[0]}}</td>
                  <!--<td ng-if="!tsc.classDetails.definition[0] && !tsc.classDetails.definitions[0]">-</td>-->
                  <td ng-if="!tsc.classDetails.definitions[0]">-</td>
                </tr>
                </tbody>
              </table>
            </div>
            <!-- /.table-responsive -->
          </div>
          <!-- /.class-details -->
          <div id="ontology-details" class="tab-pane" role="tabpanel">
            <div class="table-responsive">
              <table class="table table-striped">
                <tbody>
                <tr>
                  <th>Name</th>
                  <td>{{tsc.currentOntology.info.name}}</td>
                </tr>
                <tr>
                  <th>Acronym</th>
                  <td>{{tsc.currentOntology.info.id}}</td>
                </tr>
                <tr>
                  <th>Id</th>
                  <td>
                    <a ng-href="{{tsc.currentOntology.info['@id']}}"
                        target="_blank">{{tsc.currentOntology.info['@id']}}</a>
                  </td>
                </tr>
                <tr>
                  <th>Description</th>
                  <td>{{(tsc.currentOntology.info.details.description | htmlToPlainText) || '-'}}</td>
                </tr>
                <tr>
                  <th>No. Terms</th>
                  <td>{{tsc.currentOntology.info.details.numberOfClasses | number}}</td>
                </tr>
                </tbody>
              </table>
            </div>
            <!-- /.table-responsive -->
          </div>
        </div>
        <div class="clearfix"></div>
      </div>
      <div class="clearfix"></div>
    </div>
  </div>
</div>

<!-- Create term -->
<div ng-if="tsc.isCreating()" class="clear form-group add-ontology-class"
    ng-controller="provisionalClassController as pcc">

  <ng-include src="'scripts/controlled-term/create-ontology-class.html'"></ng-include>
  <div class="clear btn-create-term">
    <button type="button"
        class="std-button btn"
        ng-click="pcc.saveAsFieldItem(pcc.provisionalClass)"
        ng-disabled="!pcc.isValid()">Create Term
    </button>
  </div>

</div>